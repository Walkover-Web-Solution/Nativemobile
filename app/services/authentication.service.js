"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
require("rxjs/add/operator/map");
var router_1 = require("@angular/router");
var httpWrapper_service_1 = require("./httpWrapper.service");
var login_api_1 = require("./apiurls/login.api");
var catchmanger_1 = require("./catchManager/catchmanger");
var http_1 = require("@angular/http");
var general_service_1 = require("./general.service");
var service_config_1 = require("./service.config");
var AuthenticationService = (function () {
    function AuthenticationService(errorHandler, _Http, _http, _router, _generalService, config) {
        this.errorHandler = errorHandler;
        this._Http = _Http;
        this._http = _http;
        this._router = _router;
        this._generalService = _generalService;
        this.config = config;
    }
    AuthenticationService.prototype.SignupWithEmail = function (email) {
        var _this = this;
        return this._http.post(this.config.apiUrl + login_api_1.LOGIN_API.SignupWithEmail, { email: email }).map(function (res) {
            var data = res.json();
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, email); });
    };
    AuthenticationService.prototype.VerifyEmail = function (model) {
        var _this = this;
        return this._http.post(this.config.apiUrl + login_api_1.LOGIN_API.VerifyEmail, model).map(function (res) {
            var data = res.json();
            data.request = model;
            // console.log(data);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, model); });
    };
    AuthenticationService.prototype.SignupWithMobile = function (model) {
        var _this = this;
        return this._http.post(this.config.apiUrl + login_api_1.LOGIN_API.SignupWithMobile, model).map(function (res) {
            var data = res.json();
            data.request = model;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, model); });
    };
    AuthenticationService.prototype.VerifyOTP = function (modele) {
        var _this = this;
        return this._http.post(this.config.apiUrl + login_api_1.LOGIN_API.VerifyOTP, modele).map(function (res) {
            var data = res.json();
            data.request = modele;
            // console.log(data);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, modele); });
    };
    AuthenticationService.prototype.VerifyNumber = function (modele) {
        var _this = this;
        return this._http.post(this.config.apiUrl + login_api_1.LOGIN_API.VerifyNumber, modele).map(function (res) {
            var data = res.json();
            data.request = modele;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, modele); });
    };
    AuthenticationService.prototype.VerifyNumberOTP = function (modele) {
        var _this = this;
        return this._http.put(this.config.apiUrl + login_api_1.LOGIN_API.VerifyNumber, modele).map(function (res) {
            var data = res.json();
            data.request = modele;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    AuthenticationService.prototype.ClearSession = function () {
        var _this = this;
        var userName = this._generalService.user.uniqueName;
        return this._http.delete(this.config.apiUrl + login_api_1.LOGIN_API.CLEAR_SESSION.replace(':userUniqueName', encodeURIComponent(userName))).map(function (res) {
            var data = res.json();
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    AuthenticationService.prototype.LoginWithGoogle = function (token) {
        var _this = this;
        var args = {};
        args.headers = new http_1.Headers();
        args.headers.append('cache-control', 'no-cache');
        args.headers.append('Content-Type', 'application/json');
        args.headers.append('Accept', 'application/json');
        args.headers.append('Access-Token', token);
        return this._Http.get(this.config.apiUrl + login_api_1.LOGIN_API.LOGIN_WITH_GOOGLE, args).map(function (res) {
            var data = res.json();
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, args); });
    };
    AuthenticationService.prototype.LoginWithLinkedin = function (model) {
        var _this = this;
        var args = {};
        args.headers = new http_1.Headers();
        args.headers.append('cache-control', 'no-cache');
        args.headers.append('Content-Type', 'application/json');
        args.headers.append('Accept', 'application/json');
        args.headers.append('Access-Token', model.token);
        args.headers.append('User-Email', model.email);
        return this._Http.get(this.config.apiUrl + login_api_1.LOGIN_API.LOGIN_WITH_LINKEDIN, args).map(function (res) {
            var data = res.json();
            data.request = model;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, args); });
    };
    AuthenticationService.prototype.SetSettings = function (model) {
        var _this = this;
        var uniqueName = this._generalService.user.uniqueName;
        return this._http.put(this.config.apiUrl + login_api_1.LOGIN_API.SET_SETTINGS
            .replace(':userUniqueName', encodeURIComponent(uniqueName)), model).map(function (res) {
            var data = res.json();
            data.request = '';
            data.queryString = {};
            // data.response.results.forEach(p => p.isOpen = false);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, ''); });
    };
    AuthenticationService.prototype.FetchUserDetails = function () {
        var _this = this;
        var sessionId = this._generalService.user.uniqueName;
        return this._http.get(this.config.apiUrl + login_api_1.LOGIN_API.FETCH_DETAILS
            .replace(':sessionId', sessionId)).map(function (res) {
            var data = res.json();
            data.request = '';
            data.queryString = {};
            // data.response.results.forEach(p => p.isOpen = false);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, ''); });
    };
    AuthenticationService.prototype.GetSubScribedCompanies = function () {
        var _this = this;
        var userUniqueName = this._generalService.user.uniqueName;
        return this._http.get(this.config.apiUrl + login_api_1.LOGIN_API.SUBSCRIBED_COMPANIES
            .replace(':userUniqueName', userUniqueName)).map(function (res) {
            var data = res.json();
            data.request = '';
            data.queryString = {};
            // data.response.results.forEach(p => p.isOpen = false);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, ''); });
    };
    AuthenticationService.prototype.AddBalance = function (model) {
        var _this = this;
        var uniqueName = this._generalService.user.uniqueName;
        return this._http.get(this.config.apiUrl + login_api_1.LOGIN_API.ADD_BALANCE
            .replace(':uniqueName', uniqueName)).map(function (res) {
            var data = res.json();
            data.request = '';
            data.queryString = {};
            // data.response.results.forEach(p => p.isOpen = false);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, ''); });
    };
    AuthenticationService.prototype.GetAuthKey = function () {
        var _this = this;
        var uniqueName = this._generalService.user.uniqueName;
        return this._http.get(this.config.apiUrl + login_api_1.LOGIN_API.GET_AUTH_KEY
            .replace(':uniqueName', uniqueName)).map(function (res) {
            var data = res.json();
            data.request = '';
            data.queryString = {};
            // data.response.results.forEach(p => p.isOpen = false);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, ''); });
    };
    AuthenticationService.prototype.RegenerateAuthKey = function () {
        var _this = this;
        var userEmail = this._generalService.user.email;
        return this._http.put(this.config.apiUrl + login_api_1.LOGIN_API.REGENERATE_AUTH_KEY
            .replace(':userEmail', userEmail), {}).map(function (res) {
            var data = res.json();
            data.request = '';
            data.queryString = {};
            // data.response.results.forEach(p => p.isOpen = false);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, ''); });
    };
    return AuthenticationService;
}());
AuthenticationService = __decorate([
    core_1.Injectable(),
    __param(5, core_1.Optional()), __param(5, core_1.Inject(service_config_1.ServiceConfig)),
    __metadata("design:paramtypes", [catchmanger_1.ErrorHandler,
        http_1.Http,
        httpWrapper_service_1.HttpWrapperService,
        router_1.Router,
        general_service_1.GeneralService, Object])
], AuthenticationService);
exports.AuthenticationService = AuthenticationService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGljYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBNkQ7QUFDN0QsaUNBQStCO0FBRS9CLDBDQUF5QztBQUN6Qyw2REFBMkQ7QUFDM0QsaURBQWdEO0FBR2hELDBEQUEwRDtBQUMxRCxzQ0FBOEM7QUFDOUMscURBQW1EO0FBQ25ELG1EQUFxRTtBQUdyRSxJQUFhLHFCQUFxQjtJQUVoQywrQkFBb0IsWUFBMEIsRUFDckMsS0FBVyxFQUNYLEtBQXlCLEVBQ3pCLE9BQWUsRUFDZCxlQUErQixFQUNJLE1BQTBCO1FBTG5ELGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQ3JDLFVBQUssR0FBTCxLQUFLLENBQU07UUFDWCxVQUFLLEdBQUwsS0FBSyxDQUFvQjtRQUN6QixZQUFPLEdBQVAsT0FBTyxDQUFRO1FBQ2Qsb0JBQWUsR0FBZixlQUFlLENBQWdCO1FBQ0ksV0FBTSxHQUFOLE1BQU0sQ0FBb0I7SUFFdkUsQ0FBQztJQUVNLCtDQUFlLEdBQXRCLFVBQXVCLEtBQWE7UUFBcEMsaUJBS0M7UUFKQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcscUJBQVMsQ0FBQyxlQUFlLEVBQUUsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsR0FBRztZQUN4RixJQUFJLElBQUksR0FBaUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ3BELE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxLQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBaUIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxFQUF2RCxDQUF1RCxDQUFDLENBQUM7SUFDM0UsQ0FBQztJ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RUFBRSxDQUFDO1lBQ3RCLHdEQUF3RDtZQUN4RCxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsS0FBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQTBCLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBN0QsQ0FBNkQsQ0FBQyxDQUFDO0lBQ25GLENBQUM7SUFDSCw0QkFBQztBQUFELENBQUMsQUE3S0QsSUE2S0M7QUE3S1kscUJBQXFCO0lBRGpDLGlCQUFVLEVBQUU7SUFRUixXQUFBLGVBQVEsRUFBRSxDQUFBLEVBQUUsV0FBQSxhQUFNLENBQUMsOEJBQWEsQ0FBQyxDQUFBO3FDQUxGLDBCQUFZO1FBQzlCLFdBQUk7UUFDSix3Q0FBa0I7UUFDaEIsZUFBTTtRQUNHLGdDQUFjO0dBTjlCLHFCQUFxQixDQTZLakM7QUE3S1ksc0RBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9tYXAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgSHR0cFdyYXBwZXJTZXJ2aWNlIH0gZnJvbSAnLi9odHRwV3JhcHBlci5zZXJ2aWNlJztcbmltcG9ydCB7IExPR0lOX0FQSSB9IGZyb20gJy4vYXBpdXJscy9sb2dpbi5hcGknO1xuaW1wb3J0IHsgQmFzZVJlc3BvbnNlIH0gZnJvbSAnLi4vbW9kZWxzL2FwaS1tb2RlbHMvQmFzZVJlc3BvbnNlJztcbmltcG9ydCB7IEF1dGhLZXlSZXNwb25zZSwgTGlua2VkSW5SZXF1ZXN0TW9kZWwsIFNpZ251cFdpdGhNb2JpbGUsIFVzZXJEZXRhaWxzLCBWZXJpZnlFbWFpbE1vZGVsLCBWZXJpZnlFbWFpbFJlc3BvbnNlTW9kZWwsIFZlcmlmeU1vYmlsZU1vZGVsLCBWZXJpZnlNb2JpbGVSZXNwb25zZU1vZGVsIH0gZnJvbSAnLi4vbW9kZWxzL2FwaS1tb2RlbHMvbG9naW5Nb2RlbHMnO1xuaW1wb3J0IHsgRXJyb3JIYW5kbGVyIH0gZnJvbSAnLi9jYXRjaE1hbmFnZXIvY2F0Y2htYW5nZXInO1xuaW1wb3J0IHsgSGVhZGVycywgSHR0cCB9IGZyb20gJ0Bhbmd1bGFyL2h0dHAnO1xuaW1wb3J0IHsgR2VuZXJhbFNlcnZpY2UgfSBmcm9tICcuL2dlbmVyYWwuc2VydmljZSc7XG5pbXBvcnQgeyBTZXJ2aWNlQ29uZmlnLCBJU2VydmljZUNvbmZpZ0FyZ3MgfSBmcm9tICcuL3NlcnZpY2UuY29uZmlnJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEF1dGhlbnRpY2F0aW9uU2VydmljZSB7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlcixcbiAgICBwdWJsaWMgX0h0dHA6IEh0dHAsXG4gICAgcHVibGljIF9odHRwOiBIdHRwV3JhcHBlclNlcnZpY2UsXG4gICAgcHVibGljIF9yb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIF9nZW5lcmFsU2VydmljZTogR2VuZXJhbFNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChTZXJ2aWNlQ29uZmlnKSBwcml2YXRlIGNvbmZpZzogSVNlcnZpY2VDb25maWdBcmdzKSB7XG5cbiAgfVxuXG4gIHB1YmxpYyBTaWdudXBXaXRoRW1haWwoZW1haWw6IHN0cmluZyk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPHN0cmluZywgc3RyaW5nPj4ge1xuICAgIHJldHVybiB0aGlzLl9odHRwLnBvc3QodGhpcy5jb25maWcuYXBpVXJsICsgTE9HSU5fQVBJLlNpZ251cFdpdGhFbWFpbCwgeyBlbWFpbCB9KS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxzdHJpbmcsIHN0cmluZz4gPSByZXMuanNvbigpO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPHN0cmluZywgc3RyaW5nPihlLCBlbWFpbCkpO1xuICB9XG5cbiAgcHVibGljIFZlcmlmeUVtYWlsKG1vZGVsOiBWZXJpZnlFbWFpbE1vZGVsKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8VmVyaWZ5RW1haWxSZXNwb25zZU1vZGVsLCBWZXJpZnlFbWFpbE1vZGVsPj4ge1xuICAgIHJldHVybiB0aGlzLl9odHRwLnBvc3QodGhpcy5jb25maWcuYXBpVXJsICsgTE9HSU5fQVBJLlZlcmlmeUVtYWlsLCBtb2RlbCkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8VmVyaWZ5RW1haWxSZXNwb25zZU1vZGVsLCBWZXJpZnlFbWFpbE1vZGVsPiA9IHJlcy5qc29uKCk7XG4gICAgICBkYXRhLnJlcXVlc3QgPSBtb2RlbDtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPFZlcmlmeUVtYWlsUmVzcG9uc2VNb2RlbCwgVmVyaWZ5RW1haWxNb2RlbD4oZSwgbW9kZWwpKTtcbiAgfVxuXG4gIHB1YmxpYyBTaWdudXBXaXRoTW9iaWxlKG1vZGVsOiBTaWdudXBXaXRoTW9iaWxlKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8c3RyaW5nLCBTaWdudXBXaXRoTW9iaWxlPj4ge1xuICAgIHJldHVybiB0aGlzLl9odHRwLnBvc3QodGhpcy5jb25maWcuYXBpVXJsICsgTE9HSU5fQVBJLlNpZ251cFdpdGhNb2JpbGUsIG1vZGVsKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxzdHJpbmcsIFNpZ251cFdpdGhNb2JpbGU+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IG1vZGVsO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPHN0cmluZywgU2lnbnVwV2l0aE1vYmlsZT4oZSwgbW9kZWwpKTtcbiAgfVxuXG4gIHB1YmxpYyBWZXJpZnlPVFAobW9kZWxlOiBWZXJpZnlNb2JpbGVNb2RlbCk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPFZlcmlmeU1vYmlsZVJlc3BvbnNlTW9kZWwsIFZlcmlmeU1vYmlsZU1vZGVsPj4ge1xuICAgIHJldHVybiB0aGlzLl9odHRwLnBvc3QodGhpcy5jb25maWcuYXBpVXJsICsgTE9HSU5fQVBJLlZlcmlmeU9UUCwgbW9kZWxlKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxWZXJpZnlNb2JpbGVSZXNwb25zZU1vZGVsLCBWZXJpZnlNb2JpbGVNb2RlbD4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5yZXF1ZXN0ID0gbW9kZWxlO1xuICAgICAgLy8gY29uc29sZS5sb2coZGF0YSk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KS5jYXRjaCgoZSkgPT4gdGhpcy5lcnJvckhhbmRsZXIuSGFuZGxlQ2F0Y2g8VmVyaWZ5TW9iaWxlUmVzcG9uc2VNb2RlbCwgVmVyaWZ5TW9iaWxlTW9kZWw+KGUsIG1vZGVsZSkpO1xuICB9XG5cbiAgcHVibGljIFZlcmlmeU51bWJlcihtb2RlbGU6IFNpZ251cFdpdGhNb2JpbGUpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxzdHJpbmcsIFNpZ251cFdpdGhNb2JpbGU+PiB7XG4gICAgcmV0dXJuIHRoaXMuX2h0dHAucG9zdCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBMT0dJTl9BUEkuVmVyaWZ5TnVtYmVyLCBtb2RlbGUpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPHN0cmluZywgU2lnbnVwV2l0aE1vYmlsZT4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5yZXF1ZXN0ID0gbW9kZWxlO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPHN0cmluZywgU2lnbnVwV2l0aE1vYmlsZT4oZSwgbW9kZWxlKSk7XG4gIH1cblxuICBwdWJsaWMgVmVyaWZ5TnVtYmVyT1RQKG1vZGVsZTogVmVyaWZ5TW9iaWxlTW9kZWwpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxzdHJpbmcsIFZlcmlmeU1vYmlsZU1vZGVsPj4ge1xuICAgIHJldHVybiB0aGlzLl9odHRwLnB1dCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBMT0dJTl9BUEkuVmVyaWZ5TnVtYmVyLCBtb2RlbGUpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPHN0cmluZywgVmVyaWZ5TW9iaWxlTW9kZWw+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IG1vZGVsZTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxzdHJpbmcsIFZlcmlmeU1vYmlsZU1vZGVsPihlKSk7XG4gIH1cblxuICBwdWJsaWMgQ2xlYXJTZXNzaW9uKCk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPHN0cmluZywgc3RyaW5nPj4ge1xuICAgIGxldCB1c2VyTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXIudW5pcXVlTmFtZTtcbiAgICByZXR1cm4gdGhpcy5faHR0cC5kZWxldGUodGhpcy5jb25maWcuYXBpVXJsICsgTE9HSU5fQVBJLkNMRUFSX1NFU1NJT04ucmVwbGFjZSgnOnVzZXJVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KHVzZXJOYW1lKSkpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPHN0cmluZywgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KS5jYXRjaCgoZSkgPT4gdGhpcy5lcnJvckhhbmRsZXIuSGFuZGxlQ2F0Y2g8c3RyaW5nLCBzdHJpbmc+KGUpKTtcbiAgfVxuXG4gIHB1YmxpYyBMb2dpbldpdGhHb29nbGUodG9rZW46IHN0cmluZykge1xuICAgIGxldCBhcmdzOiBhbnkgPSB7fTtcbiAgICBhcmdzLmhlYWRlcnMgPSBuZXcgSGVhZGVycygpO1xuICAgIGFyZ3MuaGVhZGVycy5hcHBlbmQoJ2NhY2hlLWNvbnRyb2wnLCAnbm8tY2FjaGUnKTtcbiAgICBhcmdzLmhlYWRlcnMuYXBwZW5kKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIGFyZ3MuaGVhZGVycy5hcHBlbmQoJ0FjY2VwdCcsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgYXJncy5oZWFkZXJzLmFwcGVuZCgnQWNjZXNzLVRva2VuJywgdG9rZW4pO1xuICAgIHJldHVybiB0aGlzLl9IdHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBMT0dJTl9BUEkuTE9HSU5fV0lUSF9HT09HTEUsIGFyZ3MpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPFZlcmlmeUVtYWlsUmVzcG9uc2VNb2RlbCwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KS5jYXRjaCgoZSkgPT4gdGhpcy5lcnJvckhhbmRsZXIuSGFuZGxlQ2F0Y2g8VmVyaWZ5RW1haWxSZXNwb25zZU1vZGVsLCBzdHJpbmc+KGUsIGFyZ3MpKTtcbiAgfVxuXG4gIHB1YmxpYyBMb2dpbldpdGhMaW5rZWRpbihtb2RlbDogTGlua2VkSW5SZXF1ZXN0TW9kZWwpIHtcbiAgICBsZXQgYXJnczogYW55ID0ge307XG4gICAgYXJncy5oZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgICBhcmdzLmhlYWRlcnMuYXBwZW5kKCdjYWNoZS1jb250cm9sJywgJ25vLWNhY2hlJyk7XG4gICAgYXJncy5oZWFkZXJzLmFwcGVuZCgnQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICBhcmdzLmhlYWRlcnMuYXBwZW5kKCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIGFyZ3MuaGVhZGVycy5hcHBlbmQoJ0FjY2Vzcy1Ub2tlbicsIG1vZGVsLnRva2VuKTtcbiAgICBhcmdzLmhlYWRlcnMuYXBwZW5kKCdVc2VyLUVtYWlsJywgbW9kZWwuZW1haWwpO1xuICAgIHJldHVybiB0aGlzLl9IdHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBMT0dJTl9BUEkuTE9HSU5fV0lUSF9MSU5LRURJTiwgYXJncykubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8VmVyaWZ5RW1haWxSZXNwb25zZU1vZGVsLCBMaW5rZWRJblJlcXVlc3RNb2RlbD4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5yZXF1ZXN0ID0gbW9kZWw7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KS5jYXRjaCgoZSkgPT4gdGhpcy5lcnJvckhhbmRsZXIuSGFuZGxlQ2F0Y2g8VmVyaWZ5RW1haWxSZXNwb25zZU1vZGVsLCBMaW5rZWRJblJlcXVlc3RNb2RlbD4oZSwgYXJncykpO1xuICB9XG5cbiAgcHVibGljIFNldFNldHRpbmdzKG1vZGVsKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8c3RyaW5nLCBzdHJpbmc+PiB7XG4gICAgbGV0IHVuaXF1ZU5hbWUgPSB0aGlzLl9nZW5lcmFsU2VydmljZS51c2VyLnVuaXF1ZU5hbWU7XG5cbiAgICByZXR1cm4gdGhpcy5faHR0cC5wdXQodGhpcy5jb25maWcuYXBpVXJsICsgTE9HSU5fQVBJLlNFVF9TRVRUSU5HU1xuICAgICAgLnJlcGxhY2UoJzp1c2VyVW5pcXVlTmFtZScsIGVuY29kZVVSSUNvbXBvbmVudCh1bmlxdWVOYW1lKSksIG1vZGVsKS5tYXAoKHJlcykgPT4ge1xuICAgICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPHN0cmluZywgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICAgIGRhdGEucmVxdWVzdCA9ICcnO1xuICAgICAgICBkYXRhLnF1ZXJ5U3RyaW5nID0ge307XG4gICAgICAgIC8vIGRhdGEucmVzcG9uc2UucmVzdWx0cy5mb3JFYWNoKHAgPT4gcC5pc09wZW4gPSBmYWxzZSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPHN0cmluZywgc3RyaW5nPihlLCAnJykpO1xuICB9XG5cbiAgcHVibGljIEZldGNoVXNlckRldGFpbHMoKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8VXNlckRldGFpbHMsIHN0cmluZz4+IHtcbiAgICBsZXQgc2Vzc2lvbklkID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlci51bmlxdWVOYW1lO1xuXG4gICAgcmV0dXJuIHRoaXMuX2h0dHAuZ2V0KHRoaXMuY29uZmlnLmFwaVVybCArIExPR0lOX0FQSS5GRVRDSF9ERVRBSUxTXG4gICAgICAucmVwbGFjZSgnOnNlc3Npb25JZCcsIHNlc3Npb25JZCkpLm1hcCgocmVzKSA9PiB7XG4gICAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8VXNlckRldGFpbHMsIHN0cmluZz4gPSByZXMuanNvbigpO1xuICAgICAgICBkYXRhLnJlcXVlc3QgPSAnJztcbiAgICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHt9O1xuICAgICAgICAvLyBkYXRhLnJlc3BvbnNlLnJlc3VsdHMuZm9yRWFjaChwID0+IHAuaXNPcGVuID0gZmFsc2UpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxVc2VyRGV0YWlscywgc3RyaW5nPihlLCAnJykpO1xuICB9XG5cbiAgcHVibGljIEdldFN1YlNjcmliZWRDb21wYW5pZXMoKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8c3RyaW5nLCBzdHJpbmc+PiB7XG4gICAgbGV0IHVzZXJVbmlxdWVOYW1lID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlci51bmlxdWVOYW1lO1xuXG4gICAgcmV0dXJuIHRoaXMuX2h0dHAuZ2V0KHRoaXMuY29uZmlnLmFwaVVybCArIExPR0lOX0FQSS5TVUJTQ1JJQkVEX0NPTVBBTklFU1xuICAgICAgLnJlcGxhY2UoJzp1c2VyVW5pcXVlTmFtZScsIHVzZXJVbmlxdWVOYW1lKSkubWFwKChyZXMpID0+IHtcbiAgICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxzdHJpbmcsIHN0cmluZz4gPSByZXMuanNvbigpO1xuICAgICAgICBkYXRhLnJlcXVlc3QgPSAnJztcbiAgICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHt9O1xuICAgICAgICAvLyBkYXRhLnJlc3BvbnNlLnJlc3VsdHMuZm9yRWFjaChwID0+IHAuaXNPcGVuID0gZmFsc2UpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxzdHJpbmcsIHN0cmluZz4oZSwgJycpKTtcbiAgfVxuXG4gIHB1YmxpYyBBZGRCYWxhbmNlKG1vZGVsKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8c3RyaW5nLCBzdHJpbmc+PiB7XG4gICAgbGV0IHVuaXF1ZU5hbWUgPSB0aGlzLl9nZW5lcmFsU2VydmljZS51c2VyLnVuaXF1ZU5hbWU7XG5cbiAgICByZXR1cm4gdGhpcy5faHR0cC5nZXQodGhpcy5jb25maWcuYXBpVXJsICsgTE9HSU5fQVBJLkFERF9CQUxBTkNFXG4gICAgICAucmVwbGFjZSgnOnVuaXF1ZU5hbWUnLCB1bmlxdWVOYW1lKSkubWFwKChyZXMpID0+IHtcbiAgICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxzdHJpbmcsIHN0cmluZz4gPSByZXMuanNvbigpO1xuICAgICAgICBkYXRhLnJlcXVlc3QgPSAnJztcbiAgICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHt9O1xuICAgICAgICAvLyBkYXRhLnJlc3BvbnNlLnJlc3VsdHMuZm9yRWFjaChwID0+IHAuaXNPcGVuID0gZmFsc2UpO1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxzdHJpbmcsIHN0cmluZz4oZSwgJycpKTtcbiAgfVxuXG4gIHB1YmxpYyBHZXRBdXRoS2V5KCk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPEF1dGhLZXlSZXNwb25zZSwgc3RyaW5nPj4ge1xuICAgIGxldCB1bmlxdWVOYW1lID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlci51bmlxdWVOYW1lO1xuXG4gICAgcmV0dXJuIHRoaXMuX2h0dHAuZ2V0KHRoaXMuY29uZmlnLmFwaVVybCArIExPR0lOX0FQSS5HRVRfQVVUSF9LRVlcbiAgICAgIC5yZXBsYWNlKCc6dW5pcXVlTmFtZScsIHVuaXF1ZU5hbWUpKS5tYXAoKHJlcykgPT4ge1xuICAgICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPEF1dGhLZXlSZXNwb25zZSwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICAgIGRhdGEucmVxdWVzdCA9ICcnO1xuICAgICAgICBkYXRhLnF1ZXJ5U3RyaW5nID0ge307XG4gICAgICAgIC8vIGRhdGEucmVzcG9uc2UucmVzdWx0cy5mb3JFYWNoKHAgPT4gcC5pc09wZW4gPSBmYWxzZSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPEF1dGhLZXlSZXNwb25zZSwgc3RyaW5nPihlLCAnJykpO1xuICB9XG5cbiAgcHVibGljIFJlZ2VuZXJhdGVBdXRoS2V5KCk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPEF1dGhLZXlSZXNwb25zZSwgc3RyaW5nPj4ge1xuICAgIGxldCB1c2VyRW1haWwgPSB0aGlzLl9nZW5lcmFsU2VydmljZS51c2VyLmVtYWlsO1xuXG4gICAgcmV0dXJuIHRoaXMuX2h0dHAucHV0KHRoaXMuY29uZmlnLmFwaVVybCArIExPR0lOX0FQSS5SRUdFTkVSQVRFX0FVVEhfS0VZXG4gICAgICAucmVwbGFjZSgnOnVzZXJFbWFpbCcsIHVzZXJFbWFpbCksIHt9KS5tYXAoKHJlcykgPT4ge1xuICAgICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPEF1dGhLZXlSZXNwb25zZSwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICAgIGRhdGEucmVxdWVzdCA9ICcnO1xuICAgICAgICBkYXRhLnF1ZXJ5U3RyaW5nID0ge307XG4gICAgICAgIC8vIGRhdGEucmVzcG9uc2UucmVzdWx0cy5mb3JFYWNoKHAgPT4gcC5pc09wZW4gPSBmYWxzZSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPEF1dGhLZXlSZXNwb25zZSwgc3RyaW5nPihlLCAnJykpO1xuICB9XG59XG4iXX0=