"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
require("rxjs/add/operator/map");
var _ = require("lodash");
var router_1 = require("@angular/router");
var httpWrapper_service_1 = require("./httpWrapper.service");
var catchmanger_1 = require("./catchManager/catchmanger");
var group_api_1 = require("./apiurls/group.api");
var general_service_1 = require("./general.service");
var service_config_1 = require("./service.config");
// import { UserManager, Log, MetadataService, User } from 'oidc-client';
var GroupService = (function () {
    function GroupService(errorHandler, _http, _router, _generalService, config) {
        this.errorHandler = errorHandler;
        this._http = _http;
        this._router = _router;
        this._generalService = _generalService;
        this.config = config;
    }
    GroupService.prototype.flattenGroup = function (rawList, parents) {
        var _this = this;
        if (parents === void 0) { parents = []; }
        var listofUN;
        listofUN = _.map(rawList, function (listItem) {
            var newParents;
            var result;
            newParents = _.union([], parents);
            newParents.push({
                name: listItem.name,
                uniqueName: listItem.uniqueName
            });
            listItem = Object.assign({}, listItem, { parentGroups: [] });
            listItem.parentGroups = newParents;
            if (listItem.groups.length > 0) {
                result = _this.flattenGroup(listItem.groups, newParents);
                result.push(_.omit(listItem, 'groups'));
            }
            else {
                result = _.omit(listItem, 'groups');
            }
            return result;
        });
        return _.flatten(listofUN);
    };
    GroupService.prototype.CreateGroup = function (model) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.post(this.config.apiUrl + group_api_1.GROUP_API.CREATE.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)), model).map(function (res) {
            var data = res.json();
            data.request = model;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, model); });
    };
    GroupService.prototype.UpdateGroup = function (modele, groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.put(this.config.apiUrl + group_api_1.GROUP_API.UPDATE.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName)), modele).map(function (res) {
            var data = res.json();
            data.queryString = { groupUniqueName: groupUniqueName };
            data.request = modele;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, modele, { groupUniqueName: groupUniqueName }); });
    };
    GroupService.prototype.ShareGroup = function (modele, groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.put(this.config.apiUrl + group_api_1.GROUP_API.SHARE.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName)), modele).map(function (res) {
            var data = res.json();
            data.queryString = { groupUniqueName: groupUniqueName };
            data.request = modele;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, modele, { groupUniqueName: groupUniqueName }); });
    };
    GroupService.prototype.GetGrouptDetails = function (groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + group_api_1.GROUP_API.GET_GROUP_DETAILS.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName))).map(function (res) {
            var data = res.json();
            data.queryString = { groupUniqueName: groupUniqueName };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    // need to check on Effect
    GroupService.prototype.UnShareGroup = function (userEmail, groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.put(this.config.apiUrl + group_api_1.GROUP_API.UNSHARE.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName)), { user: userEmail }).map(function (res) {
            var data = res.json();
            data.request = userEmail;
            data.queryString = { groupUniqueName: groupUniqueName };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, userEmail, { groupUniqueName: groupUniqueName }); });
    };
    GroupService.prototype.ShareWithGroup = function (groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + group_api_1.GROUP_API.SHARED_WITH.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName))).map(function (res) {
            var data = res.json();
            data.queryString = { groupUniqueName: groupUniqueName };
            data.request = groupUniqueName;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, groupUniqueName, { groupUniqueName: groupUniqueName }); });
    };
    GroupService.prototype.GetGroupsWithAccounts = function (q) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + group_api_1.GROUP_API.GROUPS_WITH_ACCOUNT.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':q', encodeURIComponent(q || ''))).map(function (res) {
            var data = res.json();
            data.request = q;
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, q); });
    };
    GroupService.prototype.MoveGroup = function (modele, groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.put(this.config.apiUrl + group_api_1.GROUP_API.MOVE_GROUP.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName)), modele).map(function (res) {
            var data = res.json();
            data.request = modele;
            data.queryString = { groupUniqueName: groupUniqueName };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, modele, { groupUniqueName: groupUniqueName }); });
    };
    GroupService.prototype.GetGroupDetails = function (groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + group_api_1.GROUP_API.GET_GROUP_DETAILS.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName))).map(function (res) {
            var data = res.json();
            data.request = groupUniqueName;
            data.queryString = { groupUniqueName: groupUniqueName };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, groupUniqueName, { groupUniqueName: groupUniqueName }); });
    };
    GroupService.prototype.DeleteGroup = function (groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.delete(this.config.apiUrl + group_api_1.GROUP_API.DELETE_GROUP.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName))).map(function (res) {
            var data = res.json();
            data.request = groupUniqueName;
            data.queryString = { groupUniqueName: groupUniqueName };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, groupUniqueName, { groupUniqueName: groupUniqueName }); });
    };
    GroupService.prototype.GetFlattenGroupsAccounts = function (q, page, count, showEmptyGroups) {
        var _this = this;
        if (q === void 0) { q = ''; }
        if (page === void 0) { page = 1; }
        if (count === void 0) { count = 20000; }
        if (showEmptyGroups === void 0) { showEmptyGroups = 'false'; }
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + group_api_1.GROUP_API.FLATTEN_GROUP_WITH_ACCOUNTS.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName))
            .replace(':q', encodeURIComponent(q || ''))
            .replace(':page', encodeURIComponent(page.toString()))
            .replace(':count', encodeURIComponent(count.toString()))
            .replace(':showEmptyGroups', encodeURIComponent(showEmptyGroups))).map(function (res) {
            var data = res.json();
            data.request = '';
            data.queryString = { q: q, page: page, count: count, showEmptyGroups: showEmptyGroups };
            // data.response.results.forEach(p => p.isOpen = false);
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, '', { q: q, page: page, count: count, showEmptyGroups: showEmptyGroups }); });
    };
    GroupService.prototype.GetTaxHierarchy = function (groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + group_api_1.GROUP_API.TAX_HIERARCHY.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName))).map(function (res) {
            var data = res.json();
            data.request = groupUniqueName;
            data.queryString = { groupUniqueName: groupUniqueName };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, groupUniqueName, { groupUniqueName: groupUniqueName }); });
    };
    /**
     * get subgroups of a group
     * @param groupUniqueName
     */
    GroupService.prototype.GetGroupSubgroups = function (groupUniqueName) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + group_api_1.GROUP_API.GET_SUB_GROUPS.replace(':companyUniqueName', encodeURIComponent(this.companyUniqueName)).replace(':groupUniqueName', encodeURIComponent(groupUniqueName))).map(function (res) {
            var data = res.json();
            data.request = groupUniqueName;
            data.queryString = { groupUniqueName: groupUniqueName };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e, groupUniqueName, { groupUniqueName: groupUniqueName }); });
    };
    return GroupService;
}());
GroupService = __decorate([
    core_1.Injectable(),
    __param(4, core_1.Optional()), __param(4, core_1.Inject(service_config_1.ServiceConfig)),
    __metadata("design:paramtypes", [catchmanger_1.ErrorHandler, httpWrapper_service_1.HttpWrapperService,
        router_1.Router,
        general_service_1.GeneralService, Object])
], GroupService);
exports.GroupService = GroupService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JvdXAuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyb3VwLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxzQ0FBNkQ7QUFDN0QsaUNBQStCO0FBQy9CLDBCQUE0QjtBQUU1QiwwQ0FBeUM7QUFDekMsNkRBQTJEO0FBRzNELDBEQUEwRDtBQUUxRCxpREFBZ0Q7QUFFaEQscURBQW1EO0FBQ25ELG1EQUFxRTtBQUVyRSx5RUFBeUU7QUFFekUsSUFBYSxZQUFZO0lBSXZCLHNCQUFvQixZQUEwQixFQUFTLEtBQXlCLEVBQzdELE9BQWUsRUFDZCxlQUErQixFQUNJLE1BQTBCO1FBSDdELGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQVMsVUFBSyxHQUFMLEtBQUssQ0FBb0I7UUFDN0QsWUFBTyxHQUFQLE9BQU8sQ0FBUTtRQUNkLG9CQUFlLEdBQWYsZUFBZSxDQUFnQjtRQUNJLFdBQU0sR0FBTixNQUFNLENBQW9CO0lBQ2pGLENBQUM7SUFFTSxtQ0FBWSxHQUFuQixVQUFvQixPQUFjLEVBQUUsT0FBbUI7UUFBdkQsaUJBcUJDO1FBckJtQyx3QkFBQSxFQUFBLFlBQW1CO1FBQ3JELElBQUksUUFBUSxDQUFDO1FBQ2IsUUFBUSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLFVBQUMsUUFBUTtZQUNqQyxJQUFJLFVBQVUsQ0FBQztZQUNmLElBQUksTUFBTSxDQUFDO1lBQ1gsVUFBVSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ2xDLFVBQVUsQ0FBQyxJQUFJLENBQUM7Z0JBQ2QsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJO2dCQUNuQixVQUFVLEVBQUUsUUFBUSxDQUFDLFVBQVU7YUFDaEMsQ0FBQyxDQUFDO1lBQ0gsUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFDLFlBQVksRUFBRSxFQUFFLEVBQUMs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QyxXQUFXLEdBQUcsRUFBQyxlQUFlLGlCQUFBLEVBQUMsQ0FBQztZQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsS0FBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQWMsQ0FBQyxFQUFFLGVBQWUsRUFBRSxFQUFDLGVBQWUsaUJBQUEsRUFBQyxDQUFDLEVBQWpGLENBQWlGLENBQUMsQ0FBQztJQUNyRyxDQUFDO0lBRUgsbUJBQUM7QUFBRCxDQUFDLEFBekxELElBeUxDO0FBekxZLFlBQVk7SUFEeEIsaUJBQVUsRUFBRTtJQVFFLFdBQUEsZUFBUSxFQUFFLENBQUEsRUFBRSxXQUFBLGFBQU0sQ0FBQyw4QkFBYSxDQUFDLENBQUE7cUNBSFosMEJBQVksRUFBZ0Isd0NBQWtCO1FBQ3BELGVBQU07UUFDRyxnQ0FBYztHQU54QyxZQUFZLENBeUx4QjtBQXpMWSxvQ0FBWSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEdyb3VwVXBhdGVSZXF1ZXN0LCBNb3ZlR3JvdXBSZXNwb25zZSB9IGZyb20gJy4vLi4vbW9kZWxzL2FwaS1tb2RlbHMvR3JvdXAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3B0aW9uYWwsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9tYXAnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgSHR0cFdyYXBwZXJTZXJ2aWNlIH0gZnJvbSAnLi9odHRwV3JhcHBlci5zZXJ2aWNlJztcbmltcG9ydCB7IEJhc2VSZXNwb25zZSB9IGZyb20gJy4uL21vZGVscy9hcGktbW9kZWxzL0Jhc2VSZXNwb25zZSc7XG5pbXBvcnQgeyBVc2VyRGV0YWlscyB9IGZyb20gJy4uL21vZGVscy9hcGktbW9kZWxzL2xvZ2luTW9kZWxzJztcbmltcG9ydCB7IEVycm9ySGFuZGxlciB9IGZyb20gJy4vY2F0Y2hNYW5hZ2VyL2NhdGNobWFuZ2VyJztcbmltcG9ydCB7IEZsYXR0ZW5Hcm91cHNBY2NvdW50c1Jlc3BvbnNlLCBHcm91cENyZWF0ZVJlcXVlc3QsIEdyb3VwUmVzcG9uc2UsIEdyb3VwU2hhcmVkV2l0aFJlc3BvbnNlLCBHcm91cHNUYXhIaWVyYXJjaHlSZXNwb25zZSwgTW92ZUdyb3VwUmVxdWVzdCwgU2hhcmVHcm91cFJlcXVlc3QgfSBmcm9tICcuLi9tb2RlbHMvYXBpLW1vZGVscy9Hcm91cCc7XG5pbXBvcnQgeyBHUk9VUF9BUEkgfSBmcm9tICcuL2FwaXVybHMvZ3JvdXAuYXBpJztcbmltcG9ydCB7IEdyb3Vwc1dpdGhBY2NvdW50c1Jlc3BvbnNlIH0gZnJvbSAnLi4vbW9kZWxzL2FwaS1tb2RlbHMvR3JvdXBzV2l0aEFjY291bnRzJztcbmltcG9ydCB7IEdlbmVyYWxTZXJ2aWNlIH0gZnJvbSAnLi9nZW5lcmFsLnNlcnZpY2UnO1xuaW1wb3J0IHsgU2VydmljZUNvbmZpZywgSVNlcnZpY2VDb25maWdBcmdzIH0gZnJvbSAnLi9zZXJ2aWNlLmNvbmZpZyc7XG5cbi8vIGltcG9ydCB7IFVzZXJNYW5hZ2VyLCBMb2csIE1ldGFkYXRhU2VydmljZSwgVXNlciB9IGZyb20gJ29pZGMtY2xpZW50JztcbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBHcm91cFNlcnZpY2Uge1xuICBwcml2YXRlIGNvbXBhbnlVbmlxdWVOYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgdXNlcjogVXNlckRldGFpbHM7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlciwgcHVibGljIF9odHRwOiBIdHRwV3JhcHBlclNlcnZpY2UsXG4gICAgICAgICAgICAgIHB1YmxpYyBfcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgICAgICAgIHByaXZhdGUgX2dlbmVyYWxTZXJ2aWNlOiBHZW5lcmFsU2VydmljZSxcbiAgICAgICAgICAgICAgQE9wdGlvbmFsKCkgQEluamVjdChTZXJ2aWNlQ29uZmlnKSBwcml2YXRlIGNvbmZpZzogSVNlcnZpY2VDb25maWdBcmdzKSB7XG4gIH1cblxuICBwdWJsaWMgZmxhdHRlbkdyb3VwKHJhd0xpc3Q6IGFueVtdLCBwYXJlbnRzOiBhbnlbXSA9IFtdKSB7XG4gICAgbGV0IGxpc3RvZlVOO1xuICAgIGxpc3RvZlVOID0gXy5tYXAocmF3TGlzdCwgKGxpc3RJdGVtKSA9PiB7XG4gICAgICBsZXQgbmV3UGFyZW50cztcbiAgICAgIGxldCByZXN1bHQ7XG4gICAgICBuZXdQYXJlbnRzID0gXy51bmlvbihbXSwgcGFyZW50cyk7XG4gICAgICBuZXdQYXJlbnRzLnB1c2goe1xuICAgICAgICBuYW1lOiBsaXN0SXRlbS5uYW1lLFxuICAgICAgICB1bmlxdWVOYW1lOiBsaXN0SXRlbS51bmlxdWVOYW1lXG4gICAgICB9KTtcbiAgICAgIGxpc3RJdGVtID0gT2JqZWN0LmFzc2lnbih7fSwgbGlzdEl0ZW0sIHtwYXJlbnRHcm91cHM6IFtdfSk7XG4gICAgICBsaXN0SXRlbS5wYXJlbnRHcm91cHMgPSBuZXdQYXJlbnRzO1xuICAgICAgaWYgKGxpc3RJdGVtLmdyb3Vwcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZmxhdHRlbkdyb3VwKGxpc3RJdGVtLmdyb3VwcywgbmV3UGFyZW50cyk7XG4gICAgICAgIHJlc3VsdC5wdXNoKF8ub21pdChsaXN0SXRlbSwgJ2dyb3VwcycpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdCA9IF8ub21pdChsaXN0SXRlbSwgJ2dyb3VwcycpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9KTtcbiAgICByZXR1cm4gXy5mbGF0dGVuKGxpc3RvZlVOKTtcbiAgfVxuXG4gIHB1YmxpYyBDcmVhdGVHcm91cChtb2RlbDogR3JvdXBDcmVhdGVSZXF1ZXN0KTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8R3JvdXBSZXNwb25zZSwgR3JvdXBDcmVhdGVSZXF1ZXN0Pj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLnBvc3QodGhpcy5jb25maWcuYXBpVXJsICsgR1JPVVBfQVBJLkNSRUFURS5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQodGhpcy5jb21wYW55VW5pcXVlTmFtZSkpLCBtb2RlbCkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8R3JvdXBSZXNwb25zZSwgR3JvdXBDcmVhdGVSZXF1ZXN0PiA9IHJlcy5qc29uKCk7XG4gICAgICBkYXRhLnJlcXVlc3QgPSBtb2RlbDtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxHcm91cFJlc3BvbnNlLCBHcm91cENyZWF0ZVJlcXVlc3Q+KGUsIG1vZGVsKSk7XG4gIH1cblxuICBwdWJsaWMgVXBkYXRlR3JvdXAobW9kZWxlOiBHcm91cFVwYXRlUmVxdWVzdCwgZ3JvdXBVbmlxdWVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxHcm91cFJlc3BvbnNlLCBHcm91cFVwYXRlUmVxdWVzdD4+IHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLl9nZW5lcmFsU2VydmljZS51c2VyO1xuICAgIHRoaXMuY29tcGFueVVuaXF1ZU5hbWUgPSB0aGlzLl9nZW5lcmFsU2VydmljZS5jb21wYW55VW5pcXVlTmFtZTtcbiAgICByZXR1cm4gdGhpcy5faHR0cC5wdXQodGhpcy5jb25maWcuYXBpVXJsICsgR1JPVVBfQVBJLlVQREFURS5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQodGhpcy5jb21wYW55VW5pcXVlTmFtZSkpLnJlcGxhY2UoJzpncm91cFVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQoZ3JvdXBVbmlxdWVOYW1lKSksIG1vZGVsZSkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8R3JvdXBSZXNwb25zZSwgR3JvdXBVcGF0ZVJlcXVlc3Q+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7Z3JvdXBVbmlxdWVOYW1lfTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IG1vZGVsZTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxHcm91cFJlc3BvbnNlLCBHcm91cFVwYXRlUmVxdWVzdD4oZSwgbW9kZWxlLCB7Z3JvdXBVbmlxdWVOYW1lfSkpO1xuICB9XG5cbiAgcHVibGljIFNoYXJlR3JvdXAobW9kZWxlOiBTaGFyZUdyb3VwUmVxdWVzdCwgZ3JvdXBVbmlxdWVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxzdHJpbmcsIFNoYXJlR3JvdXBSZXF1ZXN0Pj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuXG4gICAgcmV0dXJuIHRoaXMuX2h0dHAucHV0KHRoaXMuY29uZmlnLmFwaVVybCArIEdST1VQX0FQSS5TSEFSRS5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQodGhpcy5jb21wYW55VW5pcXVlTmFtZSkpLnJlcGxhY2UoJzpncm91cFVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQoZ3JvdXBVbmlxdWVOYW1lKSksIG1vZGVsZSkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8c3RyaW5nLCBTaGFyZUdyb3VwUmVxdWVzdD4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHtncm91cFVuaXF1ZU5hbWV9O1xuICAgICAgZGF0YS5yZXF1ZXN0ID0gbW9kZWxlO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPHN0cmluZywgU2hhcmVHcm91cFJlcXVlc3Q+KGUsIG1vZGVsZSwge2dyb3VwVW5pcXVlTmFtZX0pKTtcbiAgfVxuXG4gIHB1YmxpYyBHZXRHcm91cHREZXRhaWxzKGdyb3VwVW5pcXVlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8R3JvdXBSZXNwb25zZSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuR0VUX0dST1VQX0RFVEFJTFMucmVwbGFjZSgnOmNvbXBhbnlVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpKS5yZXBsYWNlKCc6Z3JvdXBVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KGdyb3VwVW5pcXVlTmFtZSkpKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxHcm91cFJlc3BvbnNlLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7Z3JvdXBVbmlxdWVOYW1lfTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxHcm91cFJlc3BvbnNlLCBzdHJpbmc+KGUpKTtcbiAgfVxuXG4gIC8vIG5lZWQgdG8gY2hlY2sgb24gRWZmZWN0XG4gIHB1YmxpYyBVblNoYXJlR3JvdXAodXNlckVtYWlsOiBzdHJpbmcsIGdyb3VwVW5pcXVlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8c3RyaW5nLCBzdHJpbmc+PiB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlcjtcbiAgICB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UuY29tcGFueVVuaXF1ZU5hbWU7XG5cbiAgICByZXR1cm4gdGhpcy5faHR0cC5wdXQodGhpcy5jb25maWcuYXBpVXJsICsgR1JPVVBfQVBJLlVOU0hBUkUucmVwbGFjZSgnOmNvbXBhbnlVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpKS5yZXBsYWNlKCc6Z3JvdXBVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KGdyb3VwVW5pcXVlTmFtZSkpLCB7dXNlcjogdXNlckVtYWlsfSkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8c3RyaW5nLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IHVzZXJFbWFpbDtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7Z3JvdXBVbmlxdWVOYW1lfTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxzdHJpbmcsIHN0cmluZz4oZSwgdXNlckVtYWlsLCB7Z3JvdXBVbmlxdWVOYW1lfSkpO1xuICB9XG5cbiAgcHVibGljIFNoYXJlV2l0aEdyb3VwKGdyb3VwVW5pcXVlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8R3JvdXBTaGFyZWRXaXRoUmVzcG9uc2VbXSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuU0hBUkVEX1dJVEgucmVwbGFjZSgnOmNvbXBhbnlVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpKS5yZXBsYWNlKCc6Z3JvdXBVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KGdyb3VwVW5pcXVlTmFtZSkpKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxHcm91cFNoYXJlZFdpdGhSZXNwb25zZVtdLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7Z3JvdXBVbmlxdWVOYW1lfTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IGdyb3VwVW5pcXVlTmFtZTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxHcm91cFNoYXJlZFdpdGhSZXNwb25zZVtdLCBzdHJpbmc+KGUsIGdyb3VwVW5pcXVlTmFtZSwge2dyb3VwVW5pcXVlTmFtZX0pKTtcbiAgfVxuXG4gIHB1YmxpYyBHZXRHcm91cHNXaXRoQWNjb3VudHMocTogc3RyaW5nKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8R3JvdXBzV2l0aEFjY291bnRzUmVzcG9uc2VbXSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuR1JPVVBTX1dJVEhfQUNDT1VOVC5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQodGhpcy5jb21wYW55VW5pcXVlTmFtZSkpLnJlcGxhY2UoJzpxJywgZW5jb2RlVVJJQ29tcG9uZW50KHEgfHwgJycpKSkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8R3JvdXBzV2l0aEFjY291bnRzUmVzcG9uc2VbXSwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICBkYXRhLnJlcXVlc3QgPSBxO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPEdyb3Vwc1dpdGhBY2NvdW50c1Jlc3BvbnNlW10sIHN0cmluZz4oZSwgcSkpO1xuICB9XG5cbiAgcHVibGljIE1vdmVHcm91cChtb2RlbGU6IE1vdmVHcm91cFJlcXVlc3QsIGdyb3VwVW5pcXVlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8TW92ZUdyb3VwUmVzcG9uc2UsIE1vdmVHcm91cFJlcXVlc3Q+PiB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlcjtcbiAgICB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UuY29tcGFueVVuaXF1ZU5hbWU7XG4gICAgcmV0dXJuIHRoaXMuX2h0dHAucHV0KHRoaXMuY29uZmlnLmFwaVVybCArIEdST1VQX0FQSS5NT1ZFX0dST1VQLnJlcGxhY2UoJzpjb21wYW55VW5pcXVlTmFtZScsIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmNvbXBhbnlVbmlxdWVOYW1lKSkucmVwbGFjZSgnOmdyb3VwVW5pcXVlTmFtZScsIGVuY29kZVVSSUNvbXBvbmVudChncm91cFVuaXF1ZU5hbWUpKSwgbW9kZWxlKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxNb3ZlR3JvdXBSZXNwb25zZSwgTW92ZUdyb3VwUmVxdWVzdD4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5yZXF1ZXN0ID0gbW9kZWxlO1xuICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHtncm91cFVuaXF1ZU5hbWV9O1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPE1vdmVHcm91cFJlc3BvbnNlLCBNb3ZlR3JvdXBSZXF1ZXN0PihlLCBtb2RlbGUsIHtncm91cFVuaXF1ZU5hbWV9KSk7XG4gIH1cblxuICBwdWJsaWMgR2V0R3JvdXBEZXRhaWxzKGdyb3VwVW5pcXVlTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8R3JvdXBSZXNwb25zZSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuR0VUX0dST1VQX0RFVEFJTFMucmVwbGFjZSgnOmNvbXBhbnlVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpKS5yZXBsYWNlKCc6Z3JvdXBVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KGdyb3VwVW5pcXVlTmFtZSkpKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxHcm91cFJlc3BvbnNlLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IGdyb3VwVW5pcXVlTmFtZTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7Z3JvdXBVbmlxdWVOYW1lfTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxHcm91cFJlc3BvbnNlLCBzdHJpbmc+KGUsIGdyb3VwVW5pcXVlTmFtZSwge2dyb3VwVW5pcXVlTmFtZX0pKTtcbiAgfVxuXG4gIHB1YmxpYyBEZWxldGVHcm91cChncm91cFVuaXF1ZU5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPHN0cmluZywgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmRlbGV0ZSh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuREVMRVRFX0dST1VQLnJlcGxhY2UoJzpjb21wYW55VW5pcXVlTmFtZScsIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmNvbXBhbnlVbmlxdWVOYW1lKSkucmVwbGFjZSgnOmdyb3VwVW5pcXVlTmFtZScsIGVuY29kZVVSSUNvbXBvbmVudChncm91cFVuaXF1ZU5hbWUpKSkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8c3RyaW5nLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IGdyb3VwVW5pcXVlTmFtZTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7Z3JvdXBVbmlxdWVOYW1lfTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxzdHJpbmcsIHN0cmluZz4oZSwgZ3JvdXBVbmlxdWVOYW1lLCB7Z3JvdXBVbmlxdWVOYW1lfSkpO1xuICB9XG5cbiAgcHVibGljIEdldEZsYXR0ZW5Hcm91cHNBY2NvdW50cyhxOiBzdHJpbmcgPSAnJywgcGFnZTogbnVtYmVyID0gMSwgY291bnQ6IG51bWJlciA9IDIwMDAwLCBzaG93RW1wdHlHcm91cHM6IHN0cmluZyA9ICdmYWxzZScpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxGbGF0dGVuR3JvdXBzQWNjb3VudHNSZXNwb25zZSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuRkxBVFRFTl9HUk9VUF9XSVRIX0FDQ09VTlRTLnJlcGxhY2UoJzpjb21wYW55VW5pcXVlTmFtZScsIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmNvbXBhbnlVbmlxdWVOYW1lKSlcbiAgICAgIC5yZXBsYWNlKCc6cScsIGVuY29kZVVSSUNvbXBvbmVudChxIHx8ICcnKSlcbiAgICAgIC5yZXBsYWNlKCc6cGFnZScsIGVuY29kZVVSSUNvbXBvbmVudChwYWdlLnRvU3RyaW5nKCkpKVxuICAgICAgLnJlcGxhY2UoJzpjb3VudCcsIGVuY29kZVVSSUNvbXBvbmVudChjb3VudC50b1N0cmluZygpKSlcbiAgICAgIC5yZXBsYWNlKCc6c2hvd0VtcHR5R3JvdXBzJywgZW5jb2RlVVJJQ29tcG9uZW50KHNob3dFbXB0eUdyb3VwcykpKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxGbGF0dGVuR3JvdXBzQWNjb3VudHNSZXNwb25zZSwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICBkYXRhLnJlcXVlc3QgPSAnJztcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7cSwgcGFnZSwgY291bnQsIHNob3dFbXB0eUdyb3Vwc307XG4gICAgICAvLyBkYXRhLnJlc3BvbnNlLnJlc3VsdHMuZm9yRWFjaChwID0+IHAuaXNPcGVuID0gZmFsc2UpO1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPEZsYXR0ZW5Hcm91cHNBY2NvdW50c1Jlc3BvbnNlLCBzdHJpbmc+KGUsICcnLCB7cSwgcGFnZSwgY291bnQsIHNob3dFbXB0eUdyb3Vwc30pKTtcbiAgfVxuXG4gIHB1YmxpYyBHZXRUYXhIaWVyYXJjaHkoZ3JvdXBVbmlxdWVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxHcm91cHNUYXhIaWVyYXJjaHlSZXNwb25zZSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuVEFYX0hJRVJBUkNIWS5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQodGhpcy5jb21wYW55VW5pcXVlTmFtZSkpLnJlcGxhY2UoJzpncm91cFVuaXF1ZU5hbWUnLCBlbmNvZGVVUklDb21wb25lbnQoZ3JvdXBVbmlxdWVOYW1lKSkpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPEdyb3Vwc1RheEhpZXJhcmNoeVJlc3BvbnNlLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucmVxdWVzdCA9IGdyb3VwVW5pcXVlTmFtZTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7Z3JvdXBVbmlxdWVOYW1lfTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxHcm91cHNUYXhIaWVyYXJjaHlSZXNwb25zZSwgc3RyaW5nPihlLCBncm91cFVuaXF1ZU5hbWUsIHtncm91cFVuaXF1ZU5hbWV9KSk7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IHN1Ymdyb3VwcyBvZiBhIGdyb3VwXG4gICAqIEBwYXJhbSBncm91cFVuaXF1ZU5hbWVcbiAgICovXG4gIHB1YmxpYyBHZXRHcm91cFN1Ymdyb3Vwcyhncm91cFVuaXF1ZU5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPGFueSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBHUk9VUF9BUEkuR0VUX1NVQl9HUk9VUFMucmVwbGFjZSgnOmNvbXBhbnlVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpKS5yZXBsYWNlKCc6Z3JvdXBVbmlxdWVOYW1lJywgZW5jb2RlVVJJQ29tcG9uZW50KGdyb3VwVW5pcXVlTmFtZSkpKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxhbnksIHN0cmluZz4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5yZXF1ZXN0ID0gZ3JvdXBVbmlxdWVOYW1lO1xuICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHtncm91cFVuaXF1ZU5hbWV9O1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPGFueSwgc3RyaW5nPihlLCBncm91cFVuaXF1ZU5hbWUsIHtncm91cFVuaXF1ZU5hbWV9KSk7XG4gIH1cblxufVxuIl19