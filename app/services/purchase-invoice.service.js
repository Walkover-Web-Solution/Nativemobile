"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var httpWrapper_service_1 = require("./httpWrapper.service");
var core_1 = require("@angular/core");
var catchmanger_1 = require("./catchManager/catchmanger");
var purchase_invoice_api_1 = require("./apiurls/purchase-invoice.api");
var general_service_1 = require("./general.service");
var service_config_1 = require("./service.config");
var IInvoicePurchaseItem = (function () {
    function IInvoicePurchaseItem() {
    }
    return IInvoicePurchaseItem;
}());
exports.IInvoicePurchaseItem = IInvoicePurchaseItem;
var IInvoicePurchaseResponse = (function () {
    function IInvoicePurchaseResponse() {
    }
    return IInvoicePurchaseResponse;
}());
exports.IInvoicePurchaseResponse = IInvoicePurchaseResponse;
var ITaxResponse = (function () {
    function ITaxResponse() {
    }
    return ITaxResponse;
}());
exports.ITaxResponse = ITaxResponse;
/**** TAX MODEL ****/
/**** GENERATE PURCHASE INVOICE REQUEST ****/
var GeneratePurchaseInvoiceRequest = (function () {
    function GeneratePurchaseInvoiceRequest() {
    }
    return GeneratePurchaseInvoiceRequest;
}());
exports.GeneratePurchaseInvoiceRequest = GeneratePurchaseInvoiceRequest;
/**** GENERATE PURCHASE INVOICE REQUEST ****/
// export interface IInvoicePurchaseResponse {
//   accountName: string;
//   igstAmount: number;
//   cgstAmount: number;
//   sgstAmount: number;
//   taxableValue: number;
//   voucherNo: number;
//   gstin: string;
//   entryDate: string;
//   entryType: string;
//   particulars: string;
//   invoiceNo: string;
//   utgstAmount: number;
// }
var PurchaseInvoiceService = (function () {
    function PurchaseInvoiceService(errorHandler, _http, _generalService, config) {
        this.errorHandler = errorHandler;
        this._http = _http;
        this._generalService = _generalService;
        this.config = config;
    }
    /*
    * Get Purchase Invoice
    * API: 'company/:companyUniqueName/invoices/purchase'
    * Method: GET
    */
    PurchaseInvoiceService.prototype.GetPurchaseInvoice = function (model) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        var req = model;
        return this._http.get(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.INVOICE_API.replace(':companyUniqueName', this.companyUniqueName), req).map(function (res) {
            var data = res.json();
            data.queryString = {};
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    /*
    * Get Taxes
    * API: 'company/:companyUniqueName/tax'
    * Method: GET
    */
    PurchaseInvoiceService.prototype.GetTaxesForThisCompany = function () {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.GET_TAXES.replace(':companyUniqueName', this.companyUniqueName)).map(function (res) {
            var data = res.json();
            data.queryString = {};
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    /*
    * Update Purchase Invoice
    * API: '/company/:companyUniqueName/accounts/:accountUniqueName/invoices/generate-purchase'
    * Method: PUT
    */
    PurchaseInvoiceService.prototype.GeneratePurchaseInvoice = function (model) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        var dataToSend = {
            uniqueNames: [model.entryUniqueName],
            taxes: model.taxes
        };
        return this._http.post(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.GENERATE_PURCHASE_INVOICE.replace(':companyUniqueName', this.companyUniqueName).replace(':accountUniqueName', model.account.uniqueName), dataToSend).map(function (res) {
            var data = res.json();
            data.queryString = {};
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    /*
    * Download GSTR1 Sheet
    * API: 'gstreturn/GSTR_excel_export?monthYear=:month&gstin=:company_gstin'
    * Method: GET
    */
    PurchaseInvoiceService.prototype.DownloadGSTR1Sheet = function (reqObj) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.DOWNLOAD_GSTR1_SHEET.replace(':companyUniqueName', this.companyUniqueName).replace(':month', reqObj.month).replace(':report_sheet_Type', reqObj.type).replace(':company_gstin', reqObj.gstNumber)).map(function (res) {
            var data = res.json();
            data.queryString = { reqObj: reqObj };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    /*
    * Download GSTR1 Error Sheet
    * API: 'gstreturn/GSTR1_error_sheet?monthYear=:month&gstin=:company_gstin'
    * Method: GET
    */
    PurchaseInvoiceService.prototype.DownloadGSTR1ErrorSheet = function (reqObj) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        return this._http.get(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.DOWNLOAD_GSTR1_ERROR_SHEET.replace(':companyUniqueName', this.companyUniqueName).replace(':error_sheet_Type', reqObj.type).replace(':month', reqObj.month).replace(':company_gstin', reqObj.gstNumber)).map(function (res) {
            var data = res.json();
            data.queryString = { reqObj: reqObj };
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    PurchaseInvoiceService.prototype.UpdatePurchaseInvoice = function (entryUniqueName, taxUniqueName, accountUniqueName) {
        var _this = this;
        console.log('ENTRY', entryUniqueName);
        console.log('TAX', taxUniqueName);
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        var req = {
            uniqueNames: entryUniqueName,
            taxes: taxUniqueName
        };
        return this._http.put(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.INVOICE_API.replace(':companyUniqueName', this.companyUniqueName).replace(':accountUniqueName', accountUniqueName), req).map(function (res) {
            var data = res.json();
            data.queryString = {};
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    PurchaseInvoiceService.prototype.UpdatePurchaseEntry = function (model) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        var accountUniqueName = model.accountUniqueName;
        var ledgerUniqname = model.ledgerUniqname;
        var req = {
            invoiceNumberAgainstVoucher: model.voucherNo,
            sendToGstr2: model.sendToGstr2,
            availItc: model.availItc
        };
        return this._http.patch(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.UPDATE_PURCHASE_ENTRY.replace(':companyUniqueName', this.companyUniqueName).replace(':accountUniqueName', accountUniqueName).replace(':ledgerUniqueName', ledgerUniqname), req).map(function (res) {
            var data = res.json();
            data.queryString = {};
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    PurchaseInvoiceService.prototype.UpdateInvoice = function (model) {
        var _this = this;
        this.user = this._generalService.user;
        this.companyUniqueName = this._generalService.companyUniqueName;
        var accountUniqueName = model.accountUniqueName;
        var ledgerUniqname = model.ledgerUniqname;
        var req = {
            availItc: model.availItc,
            sendToGstr2: model.sendToGstr2
        };
        return this._http.patch(this.config.apiUrl + purchase_invoice_api_1.PURCHASE_INVOICE_API.UPDATE_INVOICE.replace(':companyUniqueName', this.companyUniqueName).replace(':accountUniqueName', accountUniqueName).replace(':ledgerUniqueName', ledgerUniqname), req).map(function (res) {
            var data = res.json();
            data.queryString = {};
            return data;
        }).catch(function (e) { return _this.errorHandler.HandleCatch(e); });
    };
    return PurchaseInvoiceService;
}());
PurchaseInvoiceService = __decorate([
    core_1.Injectable(),
    __param(3, core_1.Optional()), __param(3, core_1.Inject(service_config_1.ServiceConfig)),
    __metadata("design:paramtypes", [catchmanger_1.ErrorHandler, httpWrapper_service_1.HttpWrapperService,
        general_service_1.GeneralService, Object])
], PurchaseInvoiceService);
exports.PurchaseInvoiceService = PurchaseInvoiceService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVyY2hhc2UtaW52b2ljZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicHVyY2hhc2UtaW52b2ljZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsNkRBQTJEO0FBQzNELHNDQUE2RDtBQUc3RCwwREFBMEQ7QUFDMUQsdUVBQXNFO0FBRXRFLHFEQUFtRDtBQUNuRCxtREFBcUU7QUFRckU7SUFBQTtJQW9CQSxDQUFDO0lBQUQsMkJBQUM7QUFBRCxDQUFDLEFBcEJELElBb0JDO0FBcEJZLG9EQUFvQjtBQXNCakM7SUFBQTtJQU9BLENBQUM7SUFBRCwrQkFBQztBQUFELENBQUMsQUFQRCxJQU9DO0FBUFksNERBQXdCO0FBb0JyQztJQUFBO0lBVUEsQ0FBQztJQUFELG1CQUFDO0FBQUQsQ0FBQyxBQVZELElBVUM7QUFWWSxvQ0FBWTtBQVl6QixxQkFBcUI7QUFFckIsNkNBQTZDO0FBRTdDO0lBQUE7SUFHQSxDQUFDO0lBQUQscUNBQUM7QUFBRCxDQUFDLEFBSEQsSUFHQztBQUhZLHdFQUE4QjtBQUszQyw2Q0FBNkM7QUFFN0MsOENBQThDO0FBQzlDLHlCQUF5QjtBQUN6Qix3QkFBd0I7QUFDeEIsd0JBQXdCO0FBQ3hCLHdCQUF3QjtBQUN4QiwwQkFBMEI7QUFDMUIsdUJBQXVCO0FBQ3ZCLG1CQUFtQjtBQUNuQix1QkFBdUI7QUFDdkIsdUJBQXVCO0FBQ3ZCLHlCQUF5QjtBQUN6Qix1QkFBdUI7QUFDdkIseUJBQXlCO0FBQ3pCLElBQUk7QUFHSixJQUFhLHNCQUFzQjtJQUtqQyxnQ0FBb0IsWUFBMEIsRUFBVSxLQUF5QixFQUM3RCxlQUErQixFQUE2QyxNQUEwQjtRQUR0RyxpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUFVLFVBQUssR0FBTCxLQUFLLENBQW9CO1FBQzdELG9CQUFlLEdBQWYsZUFBZSxDQUFnQjtRQUE2QyxXQUFNLEdBQU4sTUFBTSxDQUFvQjtJQUMxSCxDQUFDO0lBRUQ7Ozs7TUFJRTtJQUNLLG1E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S0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLDJDQUFvQixDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsb0JBQW9CLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFDLG1CQUFtQixFQUFFLGNBQWMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQUc7WUFDalAsSUFBSSxJQUFJLEdBQThCLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNqRCxJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztZQUN0QixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsS0FBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQWMsQ0FBQyxDQUFDLEVBQTdDLENBQTZDLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUgsNkJBQUM7QUFBRCxDQUFDLEFBNUlELElBNElDO0FBNUlZLHNCQUFzQjtJQURsQyxpQkFBVSxFQUFFO0lBTzJDLFdBQUEsZUFBUSxFQUFFLENBQUEsRUFBRSxXQUFBLGFBQU0sQ0FBQyw4QkFBYSxDQUFDLENBQUE7cUNBRHJELDBCQUFZLEVBQWlCLHdDQUFrQjtRQUM1QyxnQ0FBYztHQU54QyxzQkFBc0IsQ0E0SWxDO0FBNUlZLHdEQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL09ic2VydmFibGUnO1xuaW1wb3J0IHsgSHR0cFdyYXBwZXJTZXJ2aWNlIH0gZnJvbSAnLi9odHRwV3JhcHBlci5zZXJ2aWNlJztcbmltcG9ydCB7IEluamVjdGFibGUsIE9wdGlvbmFsLCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFVzZXJEZXRhaWxzIH0gZnJvbSAnLi4vbW9kZWxzL2FwaS1tb2RlbHMvbG9naW5Nb2RlbHMnO1xuaW1wb3J0IHsgQmFzZVJlc3BvbnNlIH0gZnJvbSAnLi4vbW9kZWxzL2FwaS1tb2RlbHMvQmFzZVJlc3BvbnNlJztcbmltcG9ydCB7IEVycm9ySGFuZGxlciB9IGZyb20gJy4vY2F0Y2hNYW5hZ2VyL2NhdGNobWFuZ2VyJztcbmltcG9ydCB7IFBVUkNIQVNFX0lOVk9JQ0VfQVBJIH0gZnJvbSAnLi9hcGl1cmxzL3B1cmNoYXNlLWludm9pY2UuYXBpJztcbmltcG9ydCB7IENvbW1vblBhZ2luYXRlZFJlcXVlc3QgfSBmcm9tICcuLi9tb2RlbHMvYXBpLW1vZGVscy9JbnZvaWNlJztcbmltcG9ydCB7IEdlbmVyYWxTZXJ2aWNlIH0gZnJvbSAnLi9nZW5lcmFsLnNlcnZpY2UnO1xuaW1wb3J0IHsgU2VydmljZUNvbmZpZywgSVNlcnZpY2VDb25maWdBcmdzIH0gZnJvbSAnLi9zZXJ2aWNlLmNvbmZpZyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWNjb3VudCB7XG4gIG5hbWU6IHN0cmluZztcbiAgZ3N0SW46IHN0cmluZztcbiAgdW5pcXVlTmFtZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgSUludm9pY2VQdXJjaGFzZUl0ZW0ge1xuICBwdWJsaWMgYWNjb3VudDogQWNjb3VudDtcbiAgcHVibGljIGVudHJ5VW5pcXVlTmFtZTogc3RyaW5nO1xuICBwdWJsaWMgZW50cnlEYXRlOiBzdHJpbmc7XG4gIHB1YmxpYyB2b3VjaGVyTm86IG51bWJlcjtcbiAgcHVibGljIGVudHJ5VHlwZTogc3RyaW5nO1xuICBwdWJsaWMgZ3N0aW46IHN0cmluZztcbiAgcHVibGljIHBhcnRpY3VsYXI6IHN0cmluZztcbiAgcHVibGljIGludm9pY2VOdW1iZXI6IHN0cmluZztcbiAgcHVibGljIHV0Z3N0QW1vdW50OiBudW1iZXI7XG4gIHB1YmxpYyBpZ3N0QW1vdW50OiBudW1iZXI7XG4gIHB1YmxpYyBjZ3N0QW1vdW50OiBudW1iZXI7XG4gIHB1YmxpYyBzZ3N0QW1vdW50OiBudW1iZXI7XG4gIHB1YmxpYyB0YXhhYmxlVmFsdWU6IG51bWJlcjtcbiAgcHVibGljIFRheExpc3Q/OiBJVGF4UmVzcG9uc2VbXTtcbiAgcHVibGljIHRheGVzOiBzdHJpbmdbXTtcbiAgcHVibGljIGlzQWxsVGF4U2VsZWN0ZWQ/OiBib29sZWFuO1xuICBwdWJsaWMgaW52b2ljZUdlbmVyYXRlZDogYm9vbGVhbjtcbiAgcHVibGljIHNlbmRUb0dzdHIyOiBib29sZWFuO1xuICBwdWJsaWMgYXZhaWxJdGM6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBJSW52b2ljZVB1cmNoYXNlUmVzcG9uc2Uge1xuICBwdWJsaWMgY291bnQ6IG51bWJlcjtcbiAgcHVibGljIHBhZ2U6IG51bWJlcjtcbiAgcHVibGljIGl0ZW1zOiBJSW52b2ljZVB1cmNoYXNlSXRlbVtdO1xuICBwdWJsaWMgdG90YWxJdGVtczogbnVtYmVyO1xuICBwdWJsaWMgdG90YWxQYWdlczogbnVtYmVyO1xuXG59XG5cbi8qKioqIFRBWCBNT0RFTCAqKioqL1xuZXhwb3J0IGludGVyZmFjZSBUYXhBY2NvdW50IHtcbiAgdW5pcXVlTmFtZTogc3RyaW5nO1xuICBuYW1lOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGF4RGV0YWlsIHtcbiAgdGF4VmFsdWU6IG51bWJlcjtcbiAgZGF0ZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgSVRheFJlc3BvbnNlIHtcbiAgcHVibGljIHVuaXF1ZU5hbWU6IHN0cmluZztcbiAgcHVibGljIHRheFR5cGU6IHN0cmluZztcbiAgcHVibGljIGFjY291bnRzOiBUYXhBY2NvdW50W107XG4gIHB1YmxpYyB0YXhOdW1iZXI6IHN0cmluZztcbiAgcHVibGljIHRheERldGFpbDogVGF4RGV0YWlsW107XG4gIHB1YmxpYyB0YXhGaWxlRGF0ZTogbnVtYmVyO1xuICBwdWJsaWMgZHVyYXRpb246IHN0cmluZztcbiAgcHVibGljIG5hbWU6IHN0cmluZztcbiAgcHVibGljIGlzU2VsZWN0ZWQ/OiBib29sZWFuO1xufVxuXG4vKioqKiBUQVggTU9ERUwgKioqKi9cblxuLyoqKiogR0VORVJBVEUgUFVSQ0hBU0UgSU5WT0lDRSBSRVFVRVNUICoqKiovXG5cbmV4cG9ydCBjbGFzcyBHZW5lcmF0ZVB1cmNoYXNlSW52b2ljZVJlcXVlc3Qge1xuICBwdWJsaWMgZW50cnlVbmlxdWVOYW1lOiBzdHJpbmdbXTtcbiAgcHVibGljIHRheGVzOiBJVGF4UmVzcG9uc2VbXTtcbn1cblxuLyoqKiogR0VORVJBVEUgUFVSQ0hBU0UgSU5WT0lDRSBSRVFVRVNUICoqKiovXG5cbi8vIGV4cG9ydCBpbnRlcmZhY2UgSUludm9pY2VQdXJjaGFzZVJlc3BvbnNlIHtcbi8vICAgYWNjb3VudE5hbWU6IHN0cmluZztcbi8vICAgaWdzdEFtb3VudDogbnVtYmVyO1xuLy8gICBjZ3N0QW1vdW50OiBudW1iZXI7XG4vLyAgIHNnc3RBbW91bnQ6IG51bWJlcjtcbi8vICAgdGF4YWJsZVZhbHVlOiBudW1iZXI7XG4vLyAgIHZvdWNoZXJObzogbnVtYmVyO1xuLy8gICBnc3Rpbjogc3RyaW5nO1xuLy8gICBlbnRyeURhdGU6IHN0cmluZztcbi8vICAgZW50cnlUeXBlOiBzdHJpbmc7XG4vLyAgIHBhcnRpY3VsYXJzOiBzdHJpbmc7XG4vLyAgIGludm9pY2VObzogc3RyaW5nO1xuLy8gICB1dGdzdEFtb3VudDogbnVtYmVyO1xuLy8gfVxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUHVyY2hhc2VJbnZvaWNlU2VydmljZSB7XG5cbiAgcHJpdmF0ZSB1c2VyOiBVc2VyRGV0YWlscztcbiAgcHJpdmF0ZSBjb21wYW55VW5pcXVlTmFtZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXIsIHByaXZhdGUgX2h0dHA6IEh0dHBXcmFwcGVyU2VydmljZSxcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfZ2VuZXJhbFNlcnZpY2U6IEdlbmVyYWxTZXJ2aWNlLCBAT3B0aW9uYWwoKSBASW5qZWN0KFNlcnZpY2VDb25maWcpIHByaXZhdGUgY29uZmlnOiBJU2VydmljZUNvbmZpZ0FyZ3MpIHtcbiAgfVxuXG4gIC8qXG4gICogR2V0IFB1cmNoYXNlIEludm9pY2VcbiAgKiBBUEk6ICdjb21wYW55Lzpjb21wYW55VW5pcXVlTmFtZS9pbnZvaWNlcy9wdXJjaGFzZSdcbiAgKiBNZXRob2Q6IEdFVFxuICAqL1xuICBwdWJsaWMgR2V0UHVyY2hhc2VJbnZvaWNlKG1vZGVsOiBDb21tb25QYWdpbmF0ZWRSZXF1ZXN0KTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8SUludm9pY2VQdXJjaGFzZVJlc3BvbnNlLCBzdHJpbmc+PiB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlcjtcbiAgICB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UuY29tcGFueVVuaXF1ZU5hbWU7XG4gICAgbGV0IHJlcSA9IG1vZGVsO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBQVVJDSEFTRV9JTlZPSUNFX0FQSS5JTlZPSUNFX0FQSS5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lKSwgcmVxKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxJSW52b2ljZVB1cmNoYXNlUmVzcG9uc2UsIHN0cmluZz4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHt9O1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPElJbnZvaWNlUHVyY2hhc2VSZXNwb25zZSwgc3RyaW5nPihlKSk7XG4gIH1cblxuICAvKlxuICAqIEdldCBUYXhlc1xuICAqIEFQSTogJ2NvbXBhbnkvOmNvbXBhbnlVbmlxdWVOYW1lL3RheCdcbiAgKiBNZXRob2Q6IEdFVFxuICAqL1xuICBwdWJsaWMgR2V0VGF4ZXNGb3JUaGlzQ29tcGFueSgpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxJVGF4UmVzcG9uc2VbXSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBQVVJDSEFTRV9JTlZPSUNFX0FQSS5HRVRfVEFYRVMucmVwbGFjZSgnOmNvbXBhbnlVbmlxdWVOYW1lJywgdGhpcy5jb21wYW55VW5pcXVlTmFtZSkpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPElUYXhSZXNwb25zZVtdLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7fTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxJVGF4UmVzcG9uc2VbXSwgc3RyaW5nPihlKSk7XG4gIH1cblxuICAvKlxuICAqIFVwZGF0ZSBQdXJjaGFzZSBJbnZvaWNlXG4gICogQVBJOiAnL2NvbXBhbnkvOmNvbXBhbnlVbmlxdWVOYW1lL2FjY291bnRzLzphY2NvdW50VW5pcXVlTmFtZS9pbnZvaWNlcy9nZW5lcmF0ZS1wdXJjaGFzZSdcbiAgKiBNZXRob2Q6IFBVVFxuICAqL1xuICBwdWJsaWMgR2VuZXJhdGVQdXJjaGFzZUludm9pY2UobW9kZWw6IElJbnZvaWNlUHVyY2hhc2VJdGVtKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8SUludm9pY2VQdXJjaGFzZUl0ZW0sIHN0cmluZz4+IHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLl9nZW5lcmFsU2VydmljZS51c2VyO1xuICAgIHRoaXMuY29tcGFueVVuaXF1ZU5hbWUgPSB0aGlzLl9nZW5lcmFsU2VydmljZS5jb21wYW55VW5pcXVlTmFtZTtcbiAgICBsZXQgZGF0YVRvU2VuZCA9IHtcbiAgICAgIHVuaXF1ZU5hbWVzOiBbbW9kZWwuZW50cnlVbmlxdWVOYW1lXSxcbiAgICAgIHRheGVzOiBtb2RlbC50YXhlc1xuICAgIH07XG4gICAgcmV0dXJuIHRoaXMuX2h0dHAucG9zdCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBQVVJDSEFTRV9JTlZPSUNFX0FQSS5HRU5FUkFURV9QVVJDSEFTRV9JTlZPSUNFLnJlcGxhY2UoJzpjb21wYW55VW5pcXVlTmFtZScsIHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpLnJlcGxhY2UoJzphY2NvdW50VW5pcXVlTmFtZScsIG1vZGVsLmFjY291bnQudW5pcXVlTmFtZSksIGRhdGFUb1NlbmQpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPElJbnZvaWNlUHVyY2hhc2VJdGVtLCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7fTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxJSW52b2ljZVB1cmNoYXNlSXRlbSwgc3RyaW5nPihlKSk7XG4gIH1cblxuICAvKlxuICAqIERvd25sb2FkIEdTVFIxIFNoZWV0XG4gICogQVBJOiAnZ3N0cmV0dXJuL0dTVFJfZXhjZWxfZXhwb3J0P21vbnRoWWVhcj06bW9udGgmZ3N0aW49OmNvbXBhbnlfZ3N0aW4nXG4gICogTWV0aG9kOiBHRVRcbiAgKi9cbiAgcHVibGljIERvd25sb2FkR1NUUjFTaGVldChyZXFPYmo6IHsgbW9udGg6IHN0cmluZywgZ3N0TnVtYmVyOiBzdHJpbmcsIHR5cGU6IHN0cmluZyB9KTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8YW55LCBzdHJpbmc+PiB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlcjtcbiAgICB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UuY29tcGFueVVuaXF1ZU5hbWU7XG4gICAgcmV0dXJuIHRoaXMuX2h0dHAuZ2V0KHRoaXMuY29uZmlnLmFwaVVybCArIFBVUkNIQVNFX0lOVk9JQ0VfQVBJLkRPV05MT0FEX0dTVFIxX1NIRUVULnJlcGxhY2UoJzpjb21wYW55VW5pcXVlTmFtZScsIHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpLnJlcGxhY2UoJzptb250aCcsIHJlcU9iai5tb250aCkucmVwbGFjZSgnOnJlcG9ydF9zaGVldF9UeXBlJywgcmVxT2JqLnR5cGUpLnJlcGxhY2UoJzpjb21wYW55X2dzdGluJywgcmVxT2JqLmdzdE51bWJlcikpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPGFueSwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICBkYXRhLnF1ZXJ5U3RyaW5nID0ge3JlcU9ian07XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KS5jYXRjaCgoZSkgPT4gdGhpcy5lcnJvckhhbmRsZXIuSGFuZGxlQ2F0Y2g8YW55LCBzdHJpbmc+KGUpKTtcbiAgfVxuXG4gIC8qXG4gICogRG93bmxvYWQgR1NUUjEgRXJyb3IgU2hlZXRcbiAgKiBBUEk6ICdnc3RyZXR1cm4vR1NUUjFfZXJyb3Jfc2hlZXQ/bW9udGhZZWFyPTptb250aCZnc3Rpbj06Y29tcGFueV9nc3RpbidcbiAgKiBNZXRob2Q6IEdFVFxuICAqL1xuICBwdWJsaWMgRG93bmxvYWRHU1RSMUVycm9yU2hlZXQocmVxT2JqOiB7IG1vbnRoOiBzdHJpbmcsIGdzdE51bWJlcjogc3RyaW5nLCB0eXBlOiBzdHJpbmcgfSk6IE9ic2VydmFibGU8QmFzZVJlc3BvbnNlPGFueSwgc3RyaW5nPj4ge1xuICAgIHRoaXMudXNlciA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLnVzZXI7XG4gICAgdGhpcy5jb21wYW55VW5pcXVlTmFtZSA9IHRoaXMuX2dlbmVyYWxTZXJ2aWNlLmNvbXBhbnlVbmlxdWVOYW1lO1xuICAgIHJldHVybiB0aGlzLl9odHRwLmdldCh0aGlzLmNvbmZpZy5hcGlVcmwgKyBQVVJDSEFTRV9JTlZPSUNFX0FQSS5ET1dOTE9BRF9HU1RSMV9FUlJPUl9TSEVFVC5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lKS5yZXBsYWNlKCc6ZXJyb3Jfc2hlZXRfVHlwZScsIHJlcU9iai50eXBlKS5yZXBsYWNlKCc6bW9udGgnLCByZXFPYmoubW9udGgpLnJlcGxhY2UoJzpjb21wYW55X2dzdGluJywgcmVxT2JqLmdzdE51bWJlcikpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPGFueSwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICBkYXRhLnF1ZXJ5U3RyaW5nID0ge3JlcU9ian07XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KS5jYXRjaCgoZSkgPT4gdGhpcy5lcnJvckhhbmRsZXIuSGFuZGxlQ2F0Y2g8YW55LCBzdHJpbmc+KGUpKTtcbiAgfVxuXG4gIHB1YmxpYyBVcGRhdGVQdXJjaGFzZUludm9pY2UoZW50cnlVbmlxdWVOYW1lOiBzdHJpbmdbXSwgdGF4VW5pcXVlTmFtZTogc3RyaW5nW10sIGFjY291bnRVbmlxdWVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxhbnksIHN0cmluZz4+IHtcbiAgICBjb25zb2xlLmxvZygnRU5UUlknLCBlbnRyeVVuaXF1ZU5hbWUpO1xuICAgIGNvbnNvbGUubG9nKCdUQVgnLCB0YXhVbmlxdWVOYW1lKTtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLl9nZW5lcmFsU2VydmljZS51c2VyO1xuICAgIHRoaXMuY29tcGFueVVuaXF1ZU5hbWUgPSB0aGlzLl9nZW5lcmFsU2VydmljZS5jb21wYW55VW5pcXVlTmFtZTtcbiAgICBsZXQgcmVxID0ge1xuICAgICAgdW5pcXVlTmFtZXM6IGVudHJ5VW5pcXVlTmFtZSxcbiAgICAgIHRheGVzOiB0YXhVbmlxdWVOYW1lXG4gICAgfTtcbiAgICByZXR1cm4gdGhpcy5faHR0cC5wdXQodGhpcy5jb25maWcuYXBpVXJsICsgUFVSQ0hBU0VfSU5WT0lDRV9BUEkuSU5WT0lDRV9BUEkucmVwbGFjZSgnOmNvbXBhbnlVbmlxdWVOYW1lJywgdGhpcy5jb21wYW55VW5pcXVlTmFtZSkucmVwbGFjZSgnOmFjY291bnRVbmlxdWVOYW1lJywgYWNjb3VudFVuaXF1ZU5hbWUpLCByZXEpLm1hcCgocmVzKSA9PiB7XG4gICAgICBsZXQgZGF0YTogQmFzZVJlc3BvbnNlPGFueSwgc3RyaW5nPiA9IHJlcy5qc29uKCk7XG4gICAgICBkYXRhLnF1ZXJ5U3RyaW5nID0ge307XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9KS5jYXRjaCgoZSkgPT4gdGhpcy5lcnJvckhhbmRsZXIuSGFuZGxlQ2F0Y2g8YW55LCBzdHJpbmc+KGUpKTtcbiAgfVxuXG4gIHB1YmxpYyBVcGRhdGVQdXJjaGFzZUVudHJ5KG1vZGVsKTogT2JzZXJ2YWJsZTxCYXNlUmVzcG9uc2U8YW55LCBzdHJpbmc+PiB7XG4gICAgdGhpcy51c2VyID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UudXNlcjtcbiAgICB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lID0gdGhpcy5fZ2VuZXJhbFNlcnZpY2UuY29tcGFueVVuaXF1ZU5hbWU7XG4gICAgbGV0IGFjY291bnRVbmlxdWVOYW1lID0gbW9kZWwuYWNjb3VudFVuaXF1ZU5hbWU7XG4gICAgbGV0IGxlZGdlclVuaXFuYW1lID0gbW9kZWwubGVkZ2VyVW5pcW5hbWU7XG4gICAgbGV0IHJlcSA9IHtcbiAgICAgIGludm9pY2VOdW1iZXJBZ2FpbnN0Vm91Y2hlcjogbW9kZWwudm91Y2hlck5vLFxuICAgICAgc2VuZFRvR3N0cjI6IG1vZGVsLnNlbmRUb0dzdHIyLFxuICAgICAgYXZhaWxJdGM6IG1vZGVsLmF2YWlsSXRjXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9odHRwLnBhdGNoKHRoaXMuY29uZmlnLmFwaVVybCArIFBVUkNIQVNFX0lOVk9JQ0VfQVBJLlVQREFURV9QVVJDSEFTRV9FTlRSWS5yZXBsYWNlKCc6Y29tcGFueVVuaXF1ZU5hbWUnLCB0aGlzLmNvbXBhbnlVbmlxdWVOYW1lKS5yZXBsYWNlKCc6YWNjb3VudFVuaXF1ZU5hbWUnLCBhY2NvdW50VW5pcXVlTmFtZSkucmVwbGFjZSgnOmxlZGdlclVuaXF1ZU5hbWUnLCBsZWRnZXJVbmlxbmFtZSksIHJlcSkubWFwKChyZXMpID0+IHtcbiAgICAgIGxldCBkYXRhOiBCYXNlUmVzcG9uc2U8YW55LCBzdHJpbmc+ID0gcmVzLmpzb24oKTtcbiAgICAgIGRhdGEucXVlcnlTdHJpbmcgPSB7fTtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pLmNhdGNoKChlKSA9PiB0aGlzLmVycm9ySGFuZGxlci5IYW5kbGVDYXRjaDxhbnksIHN0cmluZz4oZSkpO1xuICB9XG5cbiAgcHVibGljIFVwZGF0ZUludm9pY2UobW9kZWwpOiBPYnNlcnZhYmxlPEJhc2VSZXNwb25zZTxhbnksIHN0cmluZz4+IHtcbiAgICB0aGlzLnVzZXIgPSB0aGlzLl9nZW5lcmFsU2VydmljZS51c2VyO1xuICAgIHRoaXMuY29tcGFueVVuaXF1ZU5hbWUgPSB0aGlzLl9nZW5lcmFsU2VydmljZS5jb21wYW55VW5pcXVlTmFtZTtcbiAgICBsZXQgYWNjb3VudFVuaXF1ZU5hbWUgPSBtb2RlbC5hY2NvdW50VW5pcXVlTmFtZTtcbiAgICBsZXQgbGVkZ2VyVW5pcW5hbWUgPSBtb2RlbC5sZWRnZXJVbmlxbmFtZTtcbiAgICBsZXQgcmVxID0ge1xuICAgICAgYXZhaWxJdGM6IG1vZGVsLmF2YWlsSXRjLFxuICAgICAgc2VuZFRvR3N0cjI6IG1vZGVsLnNlbmRUb0dzdHIyXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl9odHRwLnBhdGNoKHRoaXMuY29uZmlnLmFwaVVybCArIFBVUkNIQVNFX0lOVk9JQ0VfQVBJLlVQREFURV9JTlZPSUNFLnJlcGxhY2UoJzpjb21wYW55VW5pcXVlTmFtZScsIHRoaXMuY29tcGFueVVuaXF1ZU5hbWUpLnJlcGxhY2UoJzphY2NvdW50VW5pcXVlTmFtZScsIGFjY291bnRVbmlxdWVOYW1lKS5yZXBsYWNlKCc6bGVkZ2VyVW5pcXVlTmFtZScsIGxlZGdlclVuaXFuYW1lKSwgcmVxKS5tYXAoKHJlcykgPT4ge1xuICAgICAgbGV0IGRhdGE6IEJhc2VSZXNwb25zZTxhbnksIHN0cmluZz4gPSByZXMuanNvbigpO1xuICAgICAgZGF0YS5xdWVyeVN0cmluZyA9IHt9O1xuICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSkuY2F0Y2goKGUpID0+IHRoaXMuZXJyb3JIYW5kbGVyLkhhbmRsZUNhdGNoPGFueSwgc3RyaW5nPihlKSk7XG4gIH1cblxufVxuIl19